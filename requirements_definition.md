# PDF解析システム 要件定義書

## 1. システム概要
PDFや画像ファイルをアップロードし、Gemini APIを使用して内容を解析・要約するWebアプリケーション

## 2. 技術仕様
- **開発言語**: Python
- **UIフレームワーク**: Streamlit
- **AI API**: Google Gemini 1.5 Pro
- **画像変換解像度**: 200 DPI

## 3. 機能要件

### 3.1 ファイルアップロード機能
- **対応形式**: PDF, PNG, JPEG, JPG等の画像ファイル
- **複数ファイル同時アップロード**: 可能
- **ファイルサイズ制限**: なし（大容量ファイル対応）

### 3.2 解析処理機能
- **PDF処理方式**: 各ページを画像（200 DPI）に変換してGemini APIへ送信
- **大容量処理**: 50ページごとに分割処理し、結果を自動統合
- **画像解析**: 図面・表などの視覚情報も含めて解析
- **処理表示**: プログレスバー「処理中...(10/50ページ完了)」を表示

### 3.3 出力機能
- **表示形式**: Markdown形式でStreamlit上に表示
- **出力構造**:
  ```
  解析結果
  1) 要点・概要
  2) 詳細分析（データ抽出）
  3) 数値データ・概算（該当する場合）
  4) 補足情報・留意点
  ```
  ※PDFの内容に応じて項目名を自動調整（建築図面なら「数量拾い」「概算」、一般文書なら「詳細分析」「データ抽出」など）

### 3.4 エラー処理
- **破損ファイル対応**:
  - 完全破損: 「PDFファイルが破損しています。別のファイルをアップロードしてください」
  - 部分破損: 「Xページ目が読み取れませんでした。他のページで処理を続行します」
  - 処理結果に「全Yページ中、Xページを処理しました」と明記
- **API エラー**: 自動リトライ処理（最大3回）

### 3.5 複数ファイル処理
- **処理方式**: 複数ファイルを1つのレポートに統合
- **結果表示**: ファイルごとにセクション分けして表示

## 4. 非機能要件

### 4.1 パフォーマンス
- 50ページごとの分割処理で大容量ファイルに対応
- 処理進捗をリアルタイム表示

### 4.2 ユーザビリティ
- **言語**: 日本語（UI、エラーメッセージすべて）
- **セッション管理**: ブラウザセッション内で結果保持（リロードで消失）

### 4.3 制限事項
- ダウンロード機能: なし
- 履歴保存機能: なし
- プロンプトカスタマイズ: なし
- 処理中断機能: なし
- ユーザー認証: なし

## 5. システム構成案

```
app.py (メインアプリケーション)
├── components/
│   ├── file_uploader.py (ファイルアップロード処理)
│   ├── pdf_processor.py (PDF→画像変換)
│   └── gemini_analyzer.py (Gemini API連携)
├── utils/
│   ├── image_converter.py (画像変換ユーティリティ)
│   └── error_handler.py (エラー処理)
└── config.py (設定ファイル：API キー等)
```

## 6. 開発フェーズ

### Phase 1: 基本機能実装
- 単一PDFアップロード・解析機能
- Gemini API連携
- 基本的な結果表示

### Phase 2: 拡張機能実装
- 複数ファイル対応
- 大容量ファイル分割処理
- プログレスバー表示

### Phase 3: エラー処理・最適化
- エラー処理実装
- リトライ機能
- パフォーマンス最適化

## 7. 必要な外部ライブラリ（想定）
- streamlit
- google-generativeai
- pdf2image
- Pillow (PIL)
- PyPDF2 または pdfplumber
- python-dotenv (環境変数管理用)

## 8. 環境設定
- Python 3.8以上
- Gemini API キーの取得・設定
- Poppler（pdf2image用）のインストール